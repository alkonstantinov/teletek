<!DOCTYPE html>
<html lang="en" class="fullHeight">
<head>
    <!-- Required meta tags -->
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="../boostrap.css" />
    <link rel="stylesheet" href="../imports/css/all.css" />
    <link rel="stylesheet" href="../IRIS.css" />

    <title>Teletek Manager</title>
</head>
<body class="fullHeight">
    <div class="container fullHeight" id="divAddDevices">
        <!-- IMPORTANT When disable input, put class .disabled in the .form-item class -->

        <div class="row fullHeight">
            <div class="col-3 bl fire scroll">
                <div id="new_device" class="row">
                    <!--<div class="col-12" id="id_1">
                        <div class="row">
                            <div class="col-11 pr-1">
                                <a href="javascript:showDevice('power_supply', 'id_1')" onclick="javascript:addActive()">
                                    <div class="btnStyle fire">
                                        <i class="fa-solid fa-plug fa-3x p15" aria-hidden="true">
                                            <br /><span class="someS">
                                                <span class="h5">Power Supply</span>
                                            </span>
                                        </i>
                                    </div>
                                </a>
                            </div>
                            <div class="col-1 p-0 m-0" onclick="javascript:addConcreteDevice(1)">
                                <i class="fa-solid fa-xmark fire"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-12" id="id_2">
                        <div class="row">
                            <div class="col-11 pr-1">
                                <a href="javascript:showDevice('input0_outrel4_outmon4', 'id_2')" onclick="javascript:addActive()">
                                    <div class="btnStyle fire">
                                        <i class="fa-solid fa-arrow-down-up-across-line fa-3x p15" aria-hidden="true">
                                            <br /><span class="someS">
                                                  <span class="h5">INPUT0 OUTREL4 OUTMON4</span>
                                            </span>
                                        </i>
                                    </div>
                                </a>
                            </div>
                            <div class="col-1 p-0 m-0" onclick="javascript:addConcreteDevice(2)">
                                <i class="fa-solid fa-xmark fire"></i>
                            </div>
                        </div>
                    </div>-->
                </div>
            </div>
            <div class="col-9 fullHeight">
                <div id="selected_device" class="fullHeight">

                </div>
            </div>
        </div>

        <div class="modal fade bd-example" tabindex="-1" role="dialog" id="deviceList" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="row list-group fire" id="list-tab" role="tablist">
                        
                        

                    </div>
                </div>
            </div>
        </div>

        <div style="bottom: 10px; position: absolute;" class="buttons-row mt-5" id="buttons">
            <!--<button type="button" class="btn-round btn-blue">Save</button>
            <button type="button" class="btn-round btn-border-black">Back</button>-->
            <button style="display: inline-flex;" type="button" data-toggle="modal" data-target="#deviceList" id="device_btn" class="btn-round btn-border-black">
                <i class="fa-solid fa-plus 5x"></i> Add New Device
            </button>
        </div>

        <script>
            let elements;
            let lst = [];

            const BUTTON_IMAGES = {
                LOOP: { im: 'fa-solid fa-arrows-spin', sign: '' },
                OUTREL: { im: 'fa-solid fa-arrow-down-up-across-line', sign: '' },
                POWER: { im: 'fa-solid fa-plug', sign: '' },
                PANELINNETWORK: { im: 'fa-solid fa-display', sign: 'Panel' },
                INPUT: { im: 'fa fa-arrow-down', sign: 'Input' },
                OUTPUT: { im: 'fa fa-arrow-up', sign: 'Output' },
                EVAC_ZONE: { im: 'fa-solid fa-arrows-to-circle', sign: 'EVAC Zone' }, // NB! последователността е важна
                ZONE: { im: 'fa-brands fa-square-font-awesome-stroke', sign: 'Zone' },
            };
        </script>

        <!--<script>
            function myFunction(id) {
                var element = document.getElementById(id);
                element.value = element.value.slice(0, element.dataset.maxlength);
            }
            function myFunction2(id) {
                var element = document.getElementById(id);
                if (+element.value > +element.max) {
                    element.value = element.max;
                }
            }
            function myFunction3(id) {
                var element = document.getElementById(id);
                if (!element.value.includes(":")) {
                    console.log('before:', element.value);
                    element.value += ":";
                    console.log('after:', element.value);
                }
                const regex = new RegExp("[0-9]{1,2}:[0-9]{0,2}");
                console.log('test', regex.test(element.value));
                element.value = regex.exec(element.value);
                console.log(element.value);
            }

            function addActive() {
                $(document).on('click', '.btnStyle', function () {
                    $('.btnStyle').removeClass('active');// here remove class active from all btnStyle fire
                    $(this).addClass('active');// here apply selected class on clicked btnStyle fire
                });
            }

            function showDevice(id, currentId) {
                console.log('curr', currentId);
                var el = document.getElementById("selected_device");
                let ver = false;
                switch (id) {
                    case "system_sensor_loop":
                    case "tte_loop": ver = true; break

                    default: break; //pwer_supply, inputs, loops
                }
                var target = `<div class="row mt-2" id="${currentId}">
                                    ${ver ? `<div class="col-xs-12 col-md-6">
                                    <div class="form-item roww flex disabled">
                                        <label for="ver_${id}">Ver</label>
                                        <input type = "text" id = "ver_${id}" name = "ver_${id}" />
                                        </div >
                                    </div >` : ''}
                                    <div class="${ver ? 'col-xs-12 col-md-6' : 'col-12'}"><div class="form-item roww flex disabled">
                                    <label for="device_state_${id}">Device State</label>
                                    <div class="select">
                                        <select id="device_state_${id}" name="device_state_${id}">
                                            <option value="normal" selected>NORMAL</option>
                                        </select>
                                    </div></div></div>
                                </div>`;
                el.innerHTML = target;
                addVisitedBackground();
            }

            //var lst = [1, 2];
            const devices = 6;
            function addConcreteDevice(id) {
                for (i = 1; i <= devices; i++) {
                    if (lst.includes(i)) {
                        continue;
                    } else {
                        var last = i;
                        break;
                    }
                }
                if (lst.includes(parseInt(+id))) {
                    var elem = document.querySelector(`[id $= _${+id}]`);
                    if (elem) elem.parentNode.removeChild(elem);
                    lst = lst.filter(function (item) {
                        return item !== +id
                    })

                    var el = document.getElementById(`id_${id}`);
                    if (el) el.parentNode.removeChild(el);

                    let button = document.getElementById("device_btn");
                    if (lst.length < devices && button.style.display === "none") {
                        button.style.display = "inline-flex";
                    }
                }
                else {
                    let imgSource = "";
                    let link = id.substr(0, id.length - 4);
                    let title = link.toUpperCase().replaceAll("_", " ");
                    switch (link) {
                        case "power_supply": imgSource += "plug";  break;
                        case "loop1_input4":
                        case "loop1_outrel4":
                        case "system_sensor_loop":
                        case "tte_loop": imgSource += "arrows-spin"; break;
                        default: imgSource += "arrow-down-up-across-line";
                    }
                    const newUserElement = `
                                            <div class="col-12" id=${id + '_' + last}>
                                                <div class="row">
                                                    <div class="col-11 pr-1">
                                                        <a href="javascript:showDevice('${link}', 'id_${last}' )" onclick="javascript:addActive()">
                                                            <div class="btnStyle fire">
                                                                <i class="fa-solid fa-${imgSource} fa-3x p15" aria-hidden="true">
                                                                    <br /><span class="someS">
                                                                        <span class="h5">${title}</span>
                                                                    </span>
                                                                </i>
                                                            </div>
                                                        </a>
                                                    </div>
                                                    <div class="col-1 p-0 m-0" onclick="javascript:addConcreteDevice(${last})">
                                                        <i class="fa-solid fa-xmark fire"></i>
                                                    </div>
                                                </div>
                                            </div>
                                        `;
                    var element = document.getElementById("new_device");
                    var new_inner = `
                                        ${element.innerHTML}
                                        ${newUserElement}
                                    `;
                    lst.push(last);
                    element.innerHTML = new_inner;

                    // button display check
                    if (lst.length === devices) {
                        let button = document.getElementById("device_btn");
                        button.style.display = "none";
                    }
                    $('#deviceList').modal('toggle');
                }
            }
        </script>-->
    </div>
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="../imports/jquery-3.6.0.js"></script>
    <script src="../imports/popper.min.js"></script>
    <script src="../imports/boostrap@4.3.1.min.js"></script>
    <script src="../imports/bootstrap-datepicker.min.js"></script>
    <script src="../imports/font-awesome.js"></script>
    <script src="../imports/mainfuncs.js"></script>
    <script>
        function sendMessage(bc) {
            CefSharp.PostMessage(bc);
        }
                //$(document).ready(() => {
                //    sendMessage("Devices|ECLIPSE|Timeslots");
                //});
//         var wb2 = `{
//  "IRIS8_NONE": {
//    "@MIN": "1",
//    "@MAX": "12",
//    "@LNGID": "9712215a-0529-44fd-a3a1-1618109e419d",
//    "~path": "ELEMENTS.iris_peripheral_devices.CONTAINS.IRIS8_NONE"
//  },
//  "IRIS8_TTELOOP": {
//    "@MIN": "1",
//    "@MAX": "12",
//    "@LNGID": "af185ba2-2c24-41cf-8b75-c4e4f3332389",
//    "~path": "ELEMENTS.iris_peripheral_devices.CONTAINS.IRIS8_TTELOOP"
//  },
//  "IRIS8_LOOP": {
//    "@MIN": "1",
//    "@MAX": "12",
//    "@LNGID": "3b094593-70ba-4da2-afa6-4b67001518f9",
//    "~path": "ELEMENTS.iris_peripheral_devices.CONTAINS.IRIS8_LOOP"
//  },
//  "IRIS8_INPUT4_OUTREL4_OUTMON4": {
//    "@MIN": "1",
//    "@MAX": "12",
//    "@LNGID": "673c2683-1d18-42af-9b9c-22f99ae3c867",
//    "~path": "ELEMENTS.iris_peripheral_devices.CONTAINS.IRIS8_INPUT4_OUTREL4_OUTMON4"
//  },
//  "IRIS8_INPUT4_OUTREL20_OUTMON4": {
//    "@MIN": "1",
//    "@MAX": "12",
//    "@LNGID": "e1d325dd-e50c-49e6-8d2d-d1824bc9a297",
//    "~path": "ELEMENTS.iris_peripheral_devices.CONTAINS.IRIS8_INPUT4_OUTREL20_OUTMON4"
//  },
//  "IRIS8_INPUT0_OUTREL0_OUTMON4": {
//    "@MIN": "1",
//    "@MAX": "12",
//    "@LNGID": "577be944-34df-4a3a-ad21-5fb4c3f8ed50",
//    "~path": "ELEMENTS.iris_peripheral_devices.CONTAINS.IRIS8_INPUT0_OUTREL0_OUTMON4"
//  },
//  "IRIS8_INPUT0_OUTREL4_OUTMON4": {
//    "@MIN": "1",
//    "@MAX": "12",
//    "@LNGID": "83147721-1fad-446d-b3f1-80ed931a60d8",
//    "~path": "ELEMENTS.iris_peripheral_devices.CONTAINS.IRIS8_INPUT0_OUTREL4_OUTMON4"
//  },
//  "IRIS8_INPUT3_OUTREL5_OUTMON4_AUX": {
//    "@MIN": "1",
//    "@MAX": "12",
//    "@LNGID": "b3c798f1-81ab-4aae-aa28-19c1b5b1f11a",
//    "~path": "ELEMENTS.iris_peripheral_devices.CONTAINS.IRIS8_INPUT3_OUTREL5_OUTMON4_AUX"
//  },
//  "IRIS8_INPUT0_OUTREL0_OUTMON1_AUX": {
//    "@MIN": "1",
//    "@MAX": "12",
//    "@LNGID": "4cc1f800-d14e-4a5f-aafd-a8f98cf71a18",
//    "~path": "ELEMENTS.iris_peripheral_devices.CONTAINS.IRIS8_INPUT0_OUTREL0_OUTMON1_AUX"
//  },
//  "IRIS8_INPUT0_OUTREL0_OUTMON4_AUX": {
//    "@MIN": "1",
//    "@MAX": "12",
//    "@LNGID": "9d1445f3-d0b5-4f54-94df-cf708dc43c2b",
//    "~path": "ELEMENTS.iris_peripheral_devices.CONTAINS.IRIS8_INPUT0_OUTREL0_OUTMON4_AUX"
//  },
//  "IRIS8_POWER_SUPPLY": {
//    "@MIN": "1",
//    "@MAX": "12",
//    "@LNGID": "4c207580-7bcd-4f97-850e-9a9ea333a71b",
//    "~path": "ELEMENTS.iris_peripheral_devices.CONTAINS.IRIS8_POWER_SUPPLY"
//  },
//  "~path": "ELEMENTS.iris_peripheral_devices.CONTAINS"
//}`;



//        receiveMessageWPF(wb2);
    </script>
</body>
</html>
