<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

    <!-- Bootstrap CSS -->
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
          crossorigin="anonymous" />
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
    <link rel="stylesheet" href="../IRIS.css" />
    <!-- Datepicker -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css" />

    <title>Teletek ProsTe</title>
</head>
<body>
    <div class="container" id="divMain">
        <!-- IMPORTANT When disable input, put class .disabled in the .form-item class -->

        <div class="row">
            <div class="col-3 bl scroll400">
                <div id="new_device" class="row">
                    <div class="col-12" id="id_1">
                        <div class="row">
                            <div class="col-11 pr-1">
                                <a href="javascript:showDevice('power_supply')">
                                    <div class="btnStyle">
                                        <img src="../../Images/1024.Module.ico" alt="" width="25" height="25" class="m15" />
                                        <div class="someS">
                                            <h5>Power Supply</h5>
                                        </div>
                                    </div>
                                </a>
                            </div>
                            <div class="col-1 p-0 m-0" onclick="javascript:addConcreteDevice(1)">
                                <i class="fa-solid fa-xmark"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-12" id="id_2">
                        <div class="row">
                            <div class="col-11 pr-1">
                                <a href="javascript:showDevice('input0_outrel4_outmon4')">
                                    <div class="btnStyle">
                                        <img src="../../Images/1024.Module.ico" alt="" width="25" height="25" class="m15" />
                                        <div class="someS">
                                            <h5>INPUT0 OUTREL4 OUTMON4</h5>
                                        </div>
                                    </div>
                                </a>
                            </div>
                            <div class="col-1 p-0 m-0" onclick="javascript:addConcreteDevice(1)">
                                <i class="fa-solid fa-xmark"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-9">
                <div id="selected_device">

                </div>
            </div>
        </div>

        <div class="modal fade bd-example" tabindex="-1" role="dialog" id="deviceList" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="row">
                        <div class="col-4">
                            <div class="list-group" id="list-tab" role="tablist">
                                <button type="button" class="list-group-item list-group-item-action active show" id="list-power_supply-list" data-toggle="tab" href="#list-power_supply" role="tab" aria-controls="list-power_supply" aria-selected="false">Power Supply</button>
                                <button type="button" class="list-group-item list-group-item-action" id="list-input0_outrel4_outmon4-list" data-toggle="tab" href="#list-input0_outrel4_outmon4" role="tab" aria-controls="list-input0_outrel4_outmon4" aria-selected="false">INPUT0 OUTREL4 OUTMON4</button>
                                <button type="button" class="list-group-item list-group-item-action" id="list-tte_loop-list" data-toggle="tab" href="#list-tte_loop" role="tab" aria-controls="list-tte_loop" aria-selected="false">TTE LOOP</button>
                                <button type="button" class="list-group-item list-group-item-action" id="list-system_sensor_loop-list" data-toggle="tab" href="#list-system_sensor_loop" role="tab" aria-controls="list-system_sensor_loop" aria-selected="false">SYSTEM SENSOR LOOP</button>
                                <button type="button" class="list-group-item list-group-item-action" id="list-loop1_outrel4-list" data-toggle="tab" href="#list-loop1_outrel4" role="tab" aria-controls="list-loop1_outrel4" aria-selected="false">LOOP1 OUTREL4</button>
                                <button type="button" class="list-group-item list-group-item-action" id="list-loop1_input4-list" data-toggle="tab" href="#list-loop1_input4" role="tab" aria-controls="list-loop1_input4" aria-selected="false">LOOP1 INPUT4</button>
                                <button type="button" class="list-group-item list-group-item-action" id="list-input4_outrel4_outmon4-list" data-toggle="tab" href="#list-input4_outrel4_outmon4" role="tab" aria-controls="list-input4_outrel4_outmon4" aria-selected="false">INPUT4 OUTREL4 OUTMON4</button>
                                <button type="button" class="list-group-item list-group-item-action" id="list-input4_outrel20_outmon4-list" data-toggle="tab" href="#list-input4_outrel20_outmon4" role="tab" aria-controls="list-input4_outrel20_outmon4" aria-selected="false">INPUT4 OUTREL20 OUTMON4</button>
                                <button type="button" class="list-group-item list-group-item-action" id="list-input0_outrel0_outmon4-list" data-toggle="tab" href="#list-input0_outrel0_outmon4" role="tab" aria-controls="list-input0_outrel0_outmon4" aria-selected="false">INPUT0 OUTREL0 OUTMON4</button>
                                <button type="button" class="list-group-item list-group-item-action" id="list-input4_outrel0_outmon4-list" data-toggle="tab" href="#list-input4_outrel0_outmon4" role="tab" aria-controls="list-input4_outrel0_outmon4" aria-selected="false">INPUT4 OUTREL0 OUTMON4</button>
                            </div>
                        </div>
                        <div class="col-8">
                            <div class="tab-content" id="nav-tabContent">
                                <div class="tab-pane fade active show" id="list-power_supply" role="tabpanel" aria-labelledby="list-power_supply-list">
                                    <div class="row m-1 justify-content-center">
                                        <h2>Power Supply</h2>
                                    </div>
                                    <div class="row m-1 justify-content-center">
                                        <img src="../../Images/1024.Module.ico" alt="" width="100" height="100" class="m15" />
                                    </div>
                                    <div class="row m-1 justify-content-end">
                                        <button type="button" class="btn-round" id="power_supply_btn" onclick="javascript: addConcreteDevice(this.id)">Add</button>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="list-input0_outrel4_outmon4" role="tabpanel" aria-labelledby="list-input0_outrel4_outmon4-list">
                                    <div class="row m-1 justify-content-center">
                                        <h2>INPUT0 OUTREL4 OUTMON4</h2>
                                    </div>
                                    <div class="row m-1 justify-content-center">
                                        <img src="../../Images/1024.Module.ico" alt="" width="100" height="100" class="m15" />
                                    </div>
                                    <div class="row m-1 justify-content-end">
                                        <button type="button" class="btn-round" id="input0_outrel4_outmon4_btn" onclick="javascript: addConcreteDevice(this.id)">Add</button>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="list-tte_loop" role="tabpanel" aria-labelledby="list-tte_loop-list">
                                    <div class="row m-1 justify-content-center">
                                        <h2>TTE LOOP</h2>
                                    </div>
                                    <div class="row m-1 justify-content-center">
                                        <img src="../../Images/1013.LoopDecices.ico" alt="" width="100" height="100" class="m15" />
                                    </div>
                                    <div class="row m-1 justify-content-end">
                                        <button type="button" class="btn-round" id="tte_loop_btn" onclick="javascript: addConcreteDevice(this.id)">Add</button>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="list-system_sensor_loop" role="tabpanel" aria-labelledby="list-system_sensor_loop-list">
                                    <div class="row m-1 justify-content-center">
                                        <h2>SYSTEM SENSOR LOOP</h2>
                                    </div>
                                    <div class="row m-1 justify-content-center">
                                        <img src="../../Images/1013.LoopDecices.ico" alt="" width="100" height="100" class="m15" />
                                    </div>
                                    <div class="row m-1 justify-content-end">
                                        <button type="button" class="btn-round" id="system_sensor_loop_btn" onclick="javascript: addConcreteDevice(this.id)">Add</button>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="list-loop1_outrel4" role="tabpanel" aria-labelledby="list-loop1_outrel4-list">
                                    <div class="row m-1 justify-content-center">
                                        <h2>LOOP1 OUTREL4</h2>
                                    </div>
                                    <div class="row m-1 justify-content-center">
                                        <img src="../../Images/1013.LoopDecices.ico" alt="" width="100" height="100" class="m15" />
                                    </div>
                                    <div class="row m-1 justify-content-end">
                                        <button type="button" class="btn-round" id="loop1_outrel4_btn" onclick="javascript: addConcreteDevice(this.id)">Add</button>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="list-loop1_input4" role="tabpanel" aria-labelledby="list-loop1_input4-list">
                                    <div class="row m-1 justify-content-center">
                                        <h2>LOOP1 INPUT4</h2>
                                    </div>
                                    <div class="row m-1 justify-content-center">
                                        <img src="../../Images/1013.LoopDecices.ico" alt="" width="100" height="100" class="m15" />
                                    </div>
                                    <div class="row m-1 justify-content-end">
                                        <button type="button" class="btn-round" id="loop1_input4_btn" onclick="javascript: addConcreteDevice(this.id)">Add</button>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="list-input4_outrel4_outmon4" role="tabpanel" aria-labelledby="list-input4_outrel4_outmon4-list">
                                    <div class="row m-1 justify-content-center">
                                        <h2>INPUT4 OUTREL4 OUTMON4</h2>
                                    </div>
                                    <div class="row m-1 justify-content-center">
                                        <img src="../../Images/1024.Module.ico" alt="" width="100" height="100" class="m15" />
                                    </div>
                                    <div class="row m-1 justify-content-end">
                                        <button type="button" class="btn-round" id="input4_outrel4_outmon4_btn" onclick="javascript: addConcreteDevice(this.id)">Add</button>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="list-input4_outrel20_outmon4" role="tabpanel" aria-labelledby="list-input4_outrel20_outmon4-list">
                                    <div class="row m-1 justify-content-center">
                                        <h2>INPUT4 OUTREL20 OUTMON4</h2>
                                    </div>
                                    <div class="row m-1 justify-content-center">
                                        <img src="../../Images/1024.Module.ico" alt="" width="100" height="100" class="m15" />
                                    </div>
                                    <div class="row m-1 justify-content-end">
                                        <button type="button" class="btn-round" id="input4_outrel20_outmon4_btn" onclick="javascript: addConcreteDevice(this.id)">Add</button>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="list-input0_outrel0_outmon4" role="tabpanel" aria-labelledby="list-input0_outrel0_outmon4-list">
                                    <div class="row m-1 justify-content-center">
                                        <h2>INPUT0 OUTREL0 OUTMON4</h2>
                                    </div>
                                    <div class="row m-1 justify-content-center">
                                        <img src="../../Images/1024.Module.ico" alt="" width="100" height="100" class="m15" />
                                    </div>
                                    <div class="row m-1 justify-content-end">
                                        <button type="button" class="btn-round" id="input0_outrel0_outmon4_btn" onclick="javascript: addConcreteDevice(this.id)">Add</button>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="list-input4_outrel0_outmon4" role="tabpanel" aria-labelledby="list-input4_outrel0_outmon4-list">
                                    <div class="row m-1 justify-content-center">
                                        <h2>INPUT4 OUTREL0 OUTMON4</h2>
                                    </div>
                                    <div class="row m-1 justify-content-center">
                                        <img src="../../Images/1024.Module.ico" alt="" width="100" height="100" class="m15" />
                                    </div>
                                    <div class="row m-1 justify-content-end">
                                        <button type="button" class="btn-round" id="input4_outrel0_outmon4_btn" onclick="javascript: addConcreteDevice(this.id)">Add</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div style="bottom: 10px; position: sticky;" class="buttons-row mt-5">
            <button type="button" class="btn-round btn-blue">Save</button>
            <button type="button" class="btn-round btn-border-black">Back</button>
            <button style="display: inline-flex;" type="button" data-toggle="modal" data-target="#deviceList" id="device_btn" class="btn-round btn-border-black">
                <i class="fa-solid fa-plus 5x"></i> Add New Device
            </button>
        </div>


        <script>
            function myFunction(id) {
                var element = document.getElementById(id);
                element.value = element.value.slice(0, element.dataset.maxlength);
            }
            function myFunction2(id) {
                var element = document.getElementById(id);
                if (element.value > element.max) {
                    element.value = element.max;
                }
            }
            function myFunction3(id) {
                var element = document.getElementById(id);
                if (!element.value.includes(":")) {
                    console.log('before:', element.value);
                    element.value += ":";
                    console.log('after:', element.value);
                }
                const regex = new RegExp("[0-9]{1,2}:[0-9]{0,2}");
                console.log('test', regex.test(element.value));
                element.value = regex.exec(element.value);
                console.log(element.value);
            }

            function showDevice(id) {
                var el = document.getElementById("selected_device");
                let ver = false;
                switch (id) {
                    case "system_sensor_loop":
                    case "tte_loop": ver = true; break
                    
                    default: break; //pwer_supply, inputs, loops
                }
                var target = `<div class="row mt-2">
                    ${ver ? `<div class="col-xs-12 col-md-6">
                    <div class="form-item roww flex disabled">
                        <label for="ver_${id}">Ver</label>
                        <input type = "text" id = "ver_${id}" name = "ver_${id}" />
                        </div >
                    </div >` : ''}
                    <div class="${ver ? 'col-xs-12 col-md-6' : 'col-12'}"><div class="form-item roww flex disabled">
                    <label for="device_state_${id}">Device State</label>
                    <div class="select">
                        <select id="device_state_${id}" name="device_state_${id}">
                            <option value="normal" selected>NORMAL</option>
                        </select>
                    </div></div></div>
                </div>`;
                var main_target = ``;
                var proxy_target = ``;
                switch (id) {
                    case "main_board":
                    case "pgm8_expander":
                    case "zone8_expander":
                    case "wireless_expander": target = main_target; break;
                    case "proxy_card_reader_it":
                    case "proxy_card_reader": target = proxy_target; break;
                    default: break;
                }
                el.innerHTML = target;
            }

            var lst = [1, 2];
            const devices = 6;
            function addConcreteDevice(id) {
                for (i = 0; i <= devices; i++) {
                    if (lst.includes(i)) {
                        continue;
                    } else {
                        var last = i;
                        break;
                    }
                }
                if (lst.includes(parseInt(+id))) {
                    var elem = document.querySelector(`[id $= _${+id}]`);
                    if (elem) elem.parentNode.removeChild(elem);
                    lst = lst.filter(function (item) {
                        return item !== +id
                    })

                    let button = document.getElementById("device_btn");
                    if (lst.length < devices && button.style.display === "none") {
                        button.style.display = "inline-flex";
                    }
                }
                else {
                    let imgSource = "../../Images/";
                    let link = id.substr(0, id.length - 4);
                    let title = link.toUpperCase().replaceAll("_", " ");
                    switch (link) {
                        case "loop1_input4":
                        case "loop1_outrel4":
                        case "system_sensor_loop":
                        case "tte_loop": imgSource += "1013.LoopDecices.ico"; break;
                        default: imgSource += "1024.Module.ico";
                    }
                    const newUserElement = `
                                                        <div class="col-12" id=${id + '_' + last}>
                                                            <div class="row">
                                                                <div class="col-11 pr-1">
                                                                    <a href="javascript:showDevice('${link}')" >
                                                                        <div class="btnStyle">
                                                                            <img src="${imgSource}" alt="" width="25" height="25" class="m15" />
                                                                            <div class="someS">
                                                                                <h5>${title}</h5>
                                                                            </div>
                                                                        </div>
                                                                    </a>
                                                                </div>
                                                                <div class="col-1 p-0 m-0" onclick="javascript:addConcreteDevice(${last})">
                                                                    <i class="fa-solid fa-xmark"></i>
                                                                </div>
                                                            </div>
                                                        </div>
                                                `;
                    var element = document.getElementById("new_device");
                    var new_inner = `
                                                    ${element.innerHTML}
                                                    ${newUserElement}
                                                `;
                    lst.push(last);
                    element.innerHTML = new_inner;

                    // button display check
                    if (lst.length === devices) {
                        let button = document.getElementById("device_btn");
                        button.style.display = "none";
                    }
                    $('#deviceList').modal('toggle');
                }
            }
        </script>
    </div>
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.6.0.js"
            integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js"
            integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js"
            integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
            crossorigin="anonymous"></script>
    <script src="https://kit.fontawesome.com/da39e5d130.js" crossorigin="anonymous"></script>
    <!-- DatePicker Script -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>
    <script>
        function sendMessage(bc) {
            CefSharp.PostMessage(bc);
        }
        //$(document).ready(() => {
        //    sendMessage("Devices|ECLIPSE|Timeslots");
        //});
    </script>
</body>
</html>
